<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Gerador de M3U do Archive.org</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      padding: 20px;
    }
    input, button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¶ Gerador de M3U do Archive.org</h1>
  <input type="text" id="link" placeholder="Cole o link do Archive.org aqui">
  <button onclick="gerarEM3U()">Baixar M3U</button>

  <script>
    async function gerarEM3U() {
      const url = document.getElementById('link').value.trim();
      const id = url.split('/').pop();
      const api = `https://archive.org/metadata/${id}`;
      const res = await fetch(api);
      const data = await res.json();

      const files = data.files.filter(f =>
        f.name.endsWith('.mp3') || f.name.endsWith('.flac') || f.name.endsWith('.mp4') || f.name.endsWith('.wav')
      );
      const base = `https://archive.org/download/${id}/`;
      const artist = data.metadata.creator || 'Desconhecido';
      const album = data.metadata.title || 'Sem tÃ­tulo';
      const cover = base + (data.files.find(f => f.name.match(/\.(jpg|png)$/))?.name || '');

      let m3u = '#EXTM3U\n';
      m3u += `#EXTART:${artist}\n`;
      m3u += `#EXTALB:${album}\n`;
      if (cover) m3u += `#EXTIMG:${cover}\n\n`;

      files.forEach(f => {
        const title = f.name.split('/').pop().replace(/\.(mp3|flac|mp4|wav)/, '');
        let lengthFormatted = '';
        if (f.length) {
          const min = Math.floor(f.length / 60);
          const sec = Math.round(f.length % 60).toString().padStart(2, '0');
          lengthFormatted = `${min}:${sec}`;
        } else {
          lengthFormatted = '??:??';
        }
        m3u += `#EXTINF:-1,${title} (${lengthFormatted})\n`;
        m3u += base + encodeURIComponent(f.name) + '\n\n';
      });

      const blob = new Blob([m3u], { type: 'audio/x-mpegurl' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${id}.m3u`;
      link.click();
    }
  </script>
</body>
</html>
